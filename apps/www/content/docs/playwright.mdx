---
title: Playwright Testing
description: Learn how to write Playwright tests that integrate with Plate.
---

[Playwright](https://playwright.dev/) is a framework for writing end-to-end tests that run in headless browsers.

This guide describes how you can write Playwright tests that integrate with Plate using `@udecode/plate-playwright` in order to interact with and interrogate the state of the editor.

## Setup

<Steps>

### Install Playwright

Follow [Playwright's guide](https://playwright.dev/docs/intro) to install Playwright in your app and ensure that you can write basic end-to-end tests.

### Install `@udecode/plate-playwright`

```bash
npm install @udecode/plate-playwright
```

### Add `<PlatePlaywrightAdapter />`

In order for your Playwright tests to access and interact with the editor, you'll need to render `<PlatePlaywrightAdapter />` as a child of `<Plate>`.

```tsx
<Plate editor={editor}>
  <PlateContent placeholder="Type..." />
  <PlatePlaywrightAdapter />
</Plate>
```

This will expose various utilities on `window.platePlaywrightAdapter`. If you prefer, you can use custom logic to render `<PlatePlaywrightAdapter />` in your testing environment only.

### Get the editor handle

<Callout>

**What is an editor handle?**

Most code you write in your Playwight tests runs in a non-browser environment and interacts with Playwright's headless browser using Playwright's API.

Interacting with a Plate editor from a Playwright test requires running JavaScript inside the context of the browser page, which can be done using Playwright's [`evaluate` and `evaluateHandle` APIs](https://playwright.dev/docs/evaluating). Most of this is handled for you by `@udecode/plate-playwright`.

A [handle](https://playwright.dev/docs/handles) is an object that references a JavaScript object within the context of the browser. The editor handle references the `editor` instance used by your Plate editor, and has type `JSHandle<PlateEditor>`.

</Callout>

In your Playwright test, you'll need to get the editor handle before you can interact with Plate.

If you only have one Plate editor on your page, you can use `getEditorHandle` to fetch it automatically.

```ts
const editorHandle = await getEditorHandle(page);
// ...
```

If there is more than one Plate editor, you'll need to specify the editable HTML element of the editor you want to interact with using a Playwright [locator](https://playwright.dev/docs/locators) as the second argument of `getEditorHandle`.

The locator must reference exactly one HTML element matching `[data-slate-editor]`. You can use `getEditable` to locate a `[data-slate-editor]` inside an ancestor locator. 

```ts
const editable = getEditable(
  page.getByTestId('my-editor-container')
);

const editorHandle = await getEditorHandle(page, editable);
/...
```

### Start writing tests

Now that you've got the `editorHandle` for your editor, you can start writing Playwright tests that interact with the editor. See below for examples.

</Steps>

## Examples

### Get a node handle by its path

Use `getNodeByPath` to get a handle referencing the node at a specific path. To make assertions about the value of the node, convert it to json using `.jsonValue()`.

```ts
const nodeHandle = await getNodeByPath(page, editorHandle, [0]);

expect(await nodeHandle.jsonValue()).toBe({
  type: 'p',
  children: [{ text: 'My paragraph' }],
});
```

### Get the type of a node

```ts
const firstNodeType = await getTypeAtPath(page, editorHandle, [0]);
expect(firstNodeType).toBe('h1');
```

### Get the DOM node for a node

Often in Playwright, you'll want to reference a specific DOM element in order to make assertions about its state or perform operations involving it.

`getDOMNodeByPath` returns an [ElementHandle](https://playwright.dev/docs/api/class-elementhandle) for the DOM node corresponding to the Slate node at a given path.

```ts
const firstNodeEl = await getDOMNodeByPath(page, elementHandle, [0]);
await firstNodeEl.hover();
```

### Click a node

```ts
await clickAtPath(page, elementHandle, [0]);
```

### Get the selection

```ts
const selection = await getSelection(page, editorHandle);

expect(selection).toBe({
  anchor: { path: [0, 0], offset: 0 },
  focus: { path: [0, 0], offset: 7 },
});
```

### Select a point or range

In order to type at a specific point in the editor, you'll need to select that point using `setSelection`.

If you select a single point (consisting of a `path` and an `offset`), the cursor will be placed at that point. If you select a range (consisting of an `anchor` and a `focus`), that range will be selected. If you select a path, the entire node at that path will be selected.

Make sure you focus the editor before setting the selection. Focusing the editor using `editable.focus()` may not work correctly in WebKit, so the best way of doing this is with `clickAtPath`.

```ts
// Click the first paragraph to focus the editor 
await clickAtPath(page, editorHandle, [0]);

await setSelection(page, editorHandle, {
  path: [0, 0],
  offset: 2,
});

await page.keyboard.type('Hello world!');
```

## Imported queries and transforms

You may want to import a query or a transform such as `getBlockAbove` or `insertNodes` into your Playwright test and use it.

Unfortunately, this is not possible. You can only interact directly with the `editor` instance inside the browser context (using `evaluate` or `evaluateHandle`), and it isn't possible to pass imported functions from Playwright's scope into the browser. This is because neither the `editor` object nor JavaScript functions can be adequately serialized.

The best workaround is to interact with the editor in the same way that a user would, without using any imported queries or transforms. This will make your Playwright tests more likely to catch bugs in your application.

If this isn't practical, you can instead call a method on the `editor` object inside an `evaluate` or `evaluateHandle`. (Use `evaluateHandle` if you need to return a reference to a DOM node or a JavaScript object from the browser. Use `evaluate` if you need to return a serialized copy of a JavaScript object, or if you don't need to return any value.)

See [Playwright's docs](https://playwright.dev/docs/evaluating) for more information about `evaluate` and `evaluateHandle`.

```ts
await editorHandle.evaluate((editor) => {
  editor.insertNodes(/* ... */);
});
```
